<link rel="stylesheet" href="https://openlayers.org/en/v4.6.4/css/ol.css" type="text/css">
<script src="https://openlayers.org/en/v4.6.4/build/ol.js" type="text/javascript"></script>
<style>
  .ol-popup {
    position: absolute;
    background-color: white;
    -webkit-filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));
    filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #cccccc;
    bottom: 12px;
    left: -50px;
    min-width: 300px;
    min-height: 300px;
  }
  .ol-popup:after, .ol-popup:before {
    top: 100%;
    border: solid transparent;
    content: " ";
    height: 0;
    width: 0;
    position: absolute;
    pointer-events: none;
  }
  .ol-popup:after {
    border-top-color: white;
    border-width: 10px;
    left: 48px;
    margin-left: -10px;
  }
  .ol-popup:before {
    border-top-color: #cccccc;
    border-width: 11px;
    left: 48px;
    margin-left: -11px;
  }
  .ol-popup-closer {
    text-decoration: none;
    position: absolute;
    top: 2px;
    right: 8px;
  }
  .ol-popup-closer:after {
    content: "âœ–";
  }
  .map {
    min-height: 500px; 
    width: 100vw;
  }
</style>
<div id="map" class="map"></div>
<div id="popup" class="ol-popup">
  <a href="#" id="popup-closer" class="ol-popup-closer"></a>
  <div id="popup-content"></div>
</div>

<script type="text/javascript">

  var route_source = new ol.source.Vector({
    url: "http://178.32.211.147/route",
    format: new ol.format.KML({extractStyles:false}),
  })
  var route = new ol.layer.Vector({ 
    source: route_source
  });

  var bing = new ol.layer.Tile({
    visible: true,
    preload: Infinity,
    source: new ol.source.BingMaps({
      key: 'AlWoguuHB5fubEl4l0x602tHSMOJJY0spFDE_qrlL8iXTzBbQb1o-wPlImvDW6Gf',
      imagerySet: 'Road',
      maxZoom: 19
    })
  })

  /**
  * Elements that make up the popup.
  */
  var container = document.getElementById('popup');
  var content = document.getElementById('popup-content');
  var closer = document.getElementById('popup-closer');

  /**
   * Create an overlay to anchor the popup to the map.
   */
  var overlay = new ol.Overlay({
    element: container,
    autoPan: true,
    autoPanAnimation: {
      duration: 250
    }
  });

  /**
  * Add a click handler to hide the popup.
  * @return {boolean} Don't follow the href.
  */
  closer.onclick = function() {
    overlay.setPosition(undefined);
    closer.blur();
    return false;
  };

  var map = new ol.Map({
    target: 'map',
    layers: [ bing, route ],
    overlays: [overlay],
    view: new ol.View({
       center: [-11000000, 7800000],
       zoom: 4
    })
  });

  /**
  * Add a click handler to the map to render the popup.
  */
  map.on('singleclick', function(e) {
    var features = map.getFeaturesAtPixel(e.pixel)
    if (features && features.length >= 1) {
      var feature = features[0]
      var coords = feature.getGeometry().getCoordinates();
      content.innerHTML = 
      '<h6>Etape #' + feature.get("index").trim() + ' : ' + feature.get("name") + '</h6>' + 
      '<p>' + feature.get("description") + '</p>'
      overlay.setPosition(coords);
    }
     else {
      console.log("clicked blank")
     }
  });
</script>